/*!
 * Name: knowledge-base
 * Id: knowledge-base
 * Version: 1.0.0
 * Description: Suggest to the user some technical articles taken from a content library
 * Author: Guido Bellomo (https://github.com/guidone)
 * Repository: https://github.com/guidone/red-bot-knowledge-base
 */
define(["../../../src/components","../../../src/components/breadcrumbs","../../../src/components/chatbot-status","../../../src/components/info-panel","../../../src/components/page-container","../../src/components","code-plug","graphql-tag","lodash","prop-types","react","react-apollo","rsuite"],(e,t,n,o,r,s,a,i,l,c,u,d,m)=>(()=>{var p={104:(e,t,n)=>{"use strict";n.r(t);n(804);var o=n(399),r=n(186),s=n.n(r),a=n(297),i=n.n(a),l=(n(229),n(222)),c=n(889),u=n.n(c),d=n(657),m=n.n(d),p=n(435),f=n.n(p),g=n(582),h=n.n(g),b=n(738);const w=[{name:"faq.bestMatch",description:"Text shown before the list of opening hours"},{name:"faq.sorryNotFound1",description:"Answer when no support articles were found (first version)"},{name:"faq.sorryNotFound2",description:"Answer when no support articles were found (second version)"},{name:"faq.sorryNotFound3",description:"Answer when no support articles were found (third version)"},{name:"faq.askSomething1",description:"What the chatbot answer when the user requests help (first version)"},{name:"faq.askSomething2",description:"What the chatbot answer when the user requests help (second version)"},{name:"faq.askSomething3",description:"What the chatbot answer when the user requests help (third version)"},{name:"faq.no"},{name:"faq.yes"},{name:"faq.ok"},{name:"faq.wasUseful",description:"Asked if an article is useful after a search"},{name:"faq.thanksBye1",description:"Answer when the user is satisfied with the found article (first version)"},{name:"faq.thanksBye2",description:"Answer when the user is satisfied with the found article (second version)"},{name:"faq.thanksBye3",description:"Answer when the user is satisfied with the found article (third version)"},{name:"faq.selectOneOfThese",description:"Shown when the user is asked to select on of the related articles of a search"},{name:"faq.somethingWentWrong",description:"Shown when an unrecoverable error occurs"},{name:"faq.noMoreArticles",description:"Shown when user ask to more results but there aren't"}],y=({value:e,onSubmit:t=(()=>{}),disabled:n=!1})=>{const[o,r]=(0,a.useState)(e),[s,c]=(0,a.useState)(null),[u,d]=(0,a.useState)("openings"),m=(0,a.useRef)(null);return i().createElement("div",null,i().createElement(l.Nav,{appearance:"tabs",activeKey:u,onSelect:d,style:{marginBottom:"25px"}},i().createElement(l.Nav.Item,{eventKey:"openings"},"Knowledge Base"),i().createElement(l.Nav.Item,{eventKey:"translations"},"Translations")),i().createElement(l.Form,{disabled:!0,formValue:o,formError:s,ref:m,checkTrigger:"none",layout:"vertical",fluid:!0,onChange:e=>{r(e),c(null)},onCheck:e=>{c(e)}},"translations"===u&&i().createElement(a.Fragment,null,i().createElement(l.FormGroup,null,i().createElement(l.FormControl,{name:"translations",accepter:b.Dictionary,schema:w,disabled:n}))),"openings"===u&&i().createElement(a.Fragment,null,i().createElement(l.FormGroup,null,i().createElement(l.ControlLabel,null,"Answer by Default"),i().createElement(l.FormControl,{name:"answerByDefault",accepter:l.Toggle,disabled:n}),i().createElement(l.HelpBlock,null,"With this option ",i().createElement("em",null,"enabled"),", the block execute a search for every input of the user, if ",i().createElement("em",null,"disabled")," the user has to enter in the ",i().createElement("em",null,"ask question state")," entering some sentences like ",i().createElement("em",null,'"I need help"'))),i().createElement(l.FormGroup,null,i().createElement(l.ControlLabel,null,"Articles Sensitivity"),i().createElement(l.FormControl,{disabled:n,name:"threshold",accepter:b.Confidence}),i().createElement(l.HelpBlock,null,"The minimum score of an article to be considered relevant. Lower this value if the search doesn't return any value.")),i().createElement(l.FormGroup,null,i().createElement(l.ControlLabel,null,"NLP Sensitivity"),i().createElement(l.FormControl,{disabled:n,name:"nlpThreshold",accepter:b.Confidence}),i().createElement(l.HelpBlock,null,"The minimum score of an intent to be considered relevant. Lower this value if the NLP doesn't catch any intent of the user input, raise this value if the NLP of this block is interfering with the NLP of other blocks.")),i().createElement(l.FormGroup,null,i().createElement(l.ControlLabel,null,"Suggest Articles"),i().createElement(l.FormControl,{disabled:n,name:"articlesToSuggest",accepter:b.InputInteger,min:1,max:20,style:{maxWidth:"200px"},postfix:i().createElement("span",null," articles")}),i().createElement(l.HelpBlock,null,'The maximum articles to suggest if user clicks on "More articles"'))),i().createElement(l.FormGroup,{style:{marginTop:"40px"}},i().createElement(l.ButtonToolbar,null,i().createElement(l.Button,{disabled:n,appearance:"primary",onClick:()=>{m.current.check()&&t(o)}},"Save configuration"),i().createElement(l.Button,{disabled:n,appearance:"default",onClick:()=>{confirm("Reset configuration?")&&r(e)}},"Reset")))))};var E=n(875),v=n.n(E),k=n(74);function x(){}const q=function(e,t){var n,o=0,r=1,s={},a=(t=t||{}).maxAttempts||1/0;return s.open=function(){(n=new WebSocket(e,t.protocols||[])).onmessage=t.onmessage||x,n.onopen=function(e){(t.onopen||x)(e),o=0},n.onclose=function(e){1e3===e.code||1001===e.code||1005===e.code||s.reconnect(e),(t.onclose||x)(e)},n.onerror=function(e){e&&"ECONNREFUSED"===e.code?s.reconnect(e):(t.onerror||x)(e)}},s.reconnect=function(e){r&&o++<a?r=setTimeout((function(){(t.onreconnect||x)(e),s.open()}),t.timeout||1e3):(t.onmaximum||x)(e)},s.json=function(e){n.send(JSON.stringify(e))},s.send=function(e){n.send(e)},s.close=function(e,t){r=clearTimeout(r),n.close(e||1e3,t)},s.open(),s},C=new function({url:e,maxAttempts:t=10,timeout:n=5e3}){let o={};const r=(e,...t)=>{null!=o[e]&&o[e].forEach(e=>e(...t))};console.log("opening sockette",e);const s=new q(e,{timeout:n,maxAttempts:t,onmessage:e=>{let t;try{t=JSON.parse(e.data)}catch(e){}r("message",t.topic,t.payload)},onerror:e=>{console.log("connet error",e)},onmaximum:e=>{console.log("connet error",e)},onreconnect:e=>r("reconnect"),onclose:e=>r("close"),onopen:e=>r("open")}),a={on:(e,t)=>(null==o[e]&&(o[e]=[]),o[e].push(t),a),off:(e,t)=>(null!=o[e]&&(o[e]=o[e].filter(e=>e!==t)),a),close:()=>(o={},s.close(),a),send:e=>(s.send(e),a)};return a}({url:"ws://localhost:"+n(719).wsPort}),S=({reducer:e=(()=>{}),initialState:t={},onMessage:n=(()=>{})}={})=>{const o=(e,t)=>{s({type:"socket.message",topic:e,payload:t}),n(e,t)};(0,a.useEffect)(()=>(C.on("message",o),()=>C.off("message",o)),[]);const[r,s]=(0,a.useReducer)(e,t);return{state:r,dispatch:s,sendMessage:(e,t)=>C.send(JSON.stringify({topic:e,payload:t}))}},B=v()`
query($namespace: String) {
  configurations(namespace: $namespace) {
    id
    namespace
    payload
  }
}
`,N=v()`
mutation($configuration: NewConfiguration!) {
  createConfiguration(configuration: $configuration) {
    id,
    namespace,
    payload
  }
}
`,A=({namespace:e,onCompleted:t=(()=>{}),onLoaded:n=(()=>{})})=>{const{loading:o,error:r,data:s}=(0,k.useQuery)(B,{variables:{namespace:e},onCompleted:e=>{let t;if(null!=e&&null!=e.configurations&&0!==e.configurations.length)try{t=JSON.parse(e.configurations[0].payload)}catch(e){}n(t)}}),{sendMessage:a}=S();let i,l;if(null!=s&&null!=s.configurations&&0!==s.configurations.length)try{i=JSON.parse(s.configurations[0].payload)}catch(t){l=`Invalid JSON in configuration "${e}"`}const[c,{loading:u,error:d}]=(0,k.useMutation)(N,{onCompleted:t});return{loading:o,saving:u,error:r||d||l,data:i,update:t=>{c({variables:{configuration:{namespace:e,payload:JSON.stringify(t)}}}),a("mc.configuration",{namespace:e,...t})}}},F=[{title:"Knowledge Base",url:"/knowledge-base"},"Configuration"],T=()=>{const{loading:e,saving:t,error:n,data:o,update:r}=A({namespace:"faq",onCompleted:()=>l.Notification.success({title:"Configuration",description:"Configuration saved successful"})});return i().createElement(u(),{className:"page-configuration"},i().createElement(m(),{pages:F}),i().createElement(l.FlexboxGrid,{justify:"space-between"},i().createElement(l.FlexboxGrid.Item,{colspan:17,style:{paddingTop:"20px",paddingLeft:"20px"}},e&&i().createElement("div",null,"loading"),n&&i().createElement("div",null,n.message),!e&&!n&&i().createElement(y,{disabled:t,value:o,onSubmit:e=>r(e)})),i().createElement(f(),{colspan:7},"Configure the ",i().createElement("b",null,"Knowledge Base")," block, use the ",i().createElement("b",null,"Articles")," section to enter the knowledge base of your product or service.",i().createElement("br",null),"For articles that represent the same content but in different languages, use the same ",i().createElement("em",null,"slug"),", the block will take care of the rest.",i().createElement("br",null),"Adjust the sensitivity of the search engine, raise it when the results are not relevant to the user's question, lower it when the search is not returning anything, keep an eye on the system console to see the score of the searches.",i().createElement("br",null),"With ",i().createElement("b",null,"Answer by Default")," Tthe block can answer automatically to any input text message or can start answering only when the chatbot in ",i().createElement(h(),null,"faq.answer")," status, which is entered when the user types senteces like ",i().createElement("em",null,'"I need help"'),".",i().createElement("div",{style:{textAlign:"center",marginTop:"10px"}},i().createElement(l.Button,{appearance:"primary",onClick:()=>{sendMessage("faq.refresh"),l.Notification.success({title:"Knowledge Base",description:"Re-index of articles started"})}},"Refresh index")))))},{Contents:K,Categories:O}=s();(0,o.plug)("sidebar",null,{id:"knowledgebase",label:"Knowledge Base",url:"/knowledge-base",icon:"file-text",permission:"faq.edit",options:[{label:"Articles",url:"/knowledge-base",id:"faqs"},{label:"Categories",url:"/knowledge-base/categories",id:"faqs-categories"}]}),(0,o.plug)("sidebar",null,{id:"knowledgebase",label:"Knowledge Base",url:"/knowledge-base",icon:"file-text",permission:["faq.configure","configure"],options:[{label:"Configuration",url:"/knowledge-base/configure",id:"faqs-configure"}]}),(0,o.plug)("pages",O,{url:"/knowledge-base/categories",title:"Categories",id:"faq-categories",permission:"faq.edit",namespace:"faq",breadcrumbs:[{title:"Knowledge Base",url:"/knowledge-base"},"Categories"]}),(0,o.plug)("pages",T,{url:"/knowledge-base/configure",title:"Configure",id:"faqs-configure",permission:["faq.configure","configure"]}),(0,o.plug)("pages",K,{url:"/knowledge-base",title:"Knowledge Base",id:"faqs",namespace:"faq",permission:"faq.edit",breadcrumbs:["Knowledge Base","Articles"],labels:{saveContent:"Save article"}}),(0,o.plug)("permissions",null,{permission:"faq.edit",name:"Edit Kwnowledge base",description:"Add and edit articles of the knowledge base",group:"Knowledge Base"}),(0,o.plug)("permissions",null,{permission:"faq.configure",name:"Configure Kwnowledge base",description:"Configure Kwnowledge base",group:"Knowledge Base"})},719:e=>{e.exports={wsPort:1942,notificationPort:1943}},738:t=>{"use strict";t.exports=e},657:e=>{"use strict";e.exports=t},582:e=>{"use strict";e.exports=n},435:e=>{"use strict";e.exports=o},889:e=>{"use strict";e.exports=r},186:e=>{"use strict";e.exports=s},399:e=>{"use strict";e.exports=a},875:e=>{"use strict";e.exports=i},804:e=>{"use strict";e.exports=l},229:e=>{"use strict";e.exports=c},297:e=>{"use strict";e.exports=u},74:e=>{"use strict";e.exports=d},222:e=>{"use strict";e.exports=m}},f={};function g(e){if(f[e])return f[e].exports;var t=f[e]={exports:{}};return p[e](t,t.exports,g),t.exports}return g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var n in t)g.o(t,n)&&!g.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g(104)})());